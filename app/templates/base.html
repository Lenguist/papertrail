<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>{% block title %}PaperTrail{% endblock %}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
</head>
<body>
  <header>
    <h1><a href="/">PaperTrail</a></h1>
    <nav>
      <a href="/library">Library</a> |
      <a href="/auth/login">Login</a>
    </nav>
  </header>
  <main>
    {% block content %}{% endblock %}
  </main>
  <script>
    (function() {
      // Fallback: if Supabase returns to "/" with tokens in the hash, forward to /auth/callback
      try {
        var atRoot = window.location.pathname === "/";
        var hash = window.location.hash || "";
        var hasToken = hash.indexOf("access_token=") !== -1;
        if (atRoot && hasToken) {
          window.location.replace("/auth/callback" + hash);
        }
      } catch (e) {
        // no-op
      }
    })();
  </script>
</body>
</html>
